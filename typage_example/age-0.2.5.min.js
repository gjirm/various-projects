"use strict";var age=(()=>{var Ke=Object.defineProperty;var Co=Object.getOwnPropertyDescriptor;var Ho=Object.getOwnPropertyNames;var Oo=Object.prototype.hasOwnProperty;var Fe=(e,t)=>{for(var n in t)Ke(e,n,{get:t[n],enumerable:!0})},Ro=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ho(t))!Oo.call(e,o)&&o!==n&&Ke(e,o,{get:()=>t[o],enumerable:!(r=Co(t,o))||r.enumerable});return e};var No=e=>Ro(Ke({},"__esModule",{value:!0}),e);var li={};Fe(li,{Decrypter:()=>Zn,Encrypter:()=>Gn,Stanza:()=>pt,armor:()=>Mn,generateIdentity:()=>po,identityToRecipient:()=>xo,webauthn:()=>jn});var Ot=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function se(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function G(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Z(e,...t){if(!se(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Rt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");G(e.outputLen),G(e.blockLen)}function zt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function $n(e,t){Z(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function ie(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function W(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Pt(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function rt(e,t){return e<<32-t|e>>>t}function K(e,t){return e<<t|e>>>32-t>>>0}var ko=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Mo(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Do(e){for(let t=0;t<e.length;t++)e[t]=Mo(e[t]);return e}var je=ko?e=>e:Do,Wn=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",qo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Nt(e){if(Z(e),Wn)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=qo[e[n]];return t}var gt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Yn(e){if(e>=gt._0&&e<=gt._9)return e-gt._0;if(e>=gt.A&&e<=gt.F)return e-(gt.A-10);if(e>=gt.a&&e<=gt.f)return e-(gt.a-10)}function ce(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Wn)return Uint8Array.fromHex(e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let c=Yn(e.charCodeAt(s)),i=Yn(e.charCodeAt(s+1));if(c===void 0||i===void 0){let f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[o]=c*16+i}return r}function fe(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Lt(e){return typeof e=="string"&&(e=fe(e)),Z(e),e}function Ge(e){return typeof e=="string"&&(e=fe(e)),Z(e),e}function Vt(...e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];Z(o),t+=o.length}let n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){let s=e[r];n.set(s,o),o+=s.length}return n}function ae(e,t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(e,t)}var Zt=class{};function Ze(e){let t=r=>e().update(Lt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function X(e=32){if(Ot&&typeof Ot.getRandomValues=="function")return Ot.getRandomValues(new Uint8Array(e));if(Ot&&typeof Ot.randomBytes=="function")return Uint8Array.from(Ot.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}var ue=class extends Zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Rt(t);let r=Lt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let c=0;c<s.length;c++)s[c]^=54;this.iHash.update(s),this.oHash=t.create();for(let c=0;c<s.length;c++)s[c]^=106;this.oHash.update(s),W(s)}update(t){return zt(this),this.iHash.update(t),this}digestInto(t){zt(this),Z(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:c,outputLen:i}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=c,t.outputLen=i,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},wt=(e,t,n)=>new ue(e,t).update(n).digest();wt.create=(e,t)=>new ue(e,t);function Pe(e,t,n){return Rt(e),n===void 0&&(n=new Uint8Array(e.outputLen)),wt(e,Lt(n),Lt(t))}var ze=Uint8Array.from([0]),Qn=Uint8Array.of();function Ko(e,t,n,r=32){Rt(e),G(r);let o=e.outputLen;if(r>255*o)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(r/o);n===void 0&&(n=Qn);let c=new Uint8Array(s*o),i=wt.create(e,t),f=i._cloneInto(),u=new Uint8Array(i.outputLen);for(let h=0;h<s;h++)ze[0]=h+1,f.update(h===0?Qn:u).update(n).update(ze).digestInto(u),c.set(u,o*h),i._cloneInto(f);return i.destroy(),f.destroy(),W(u,ze),c.slice(0,r)}var Ut=(e,t,n,r,o)=>Ko(e,Pe(e,t,n),r,o);function Fo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),c=Number(n>>o&s),i=Number(n&s),f=r?4:0,u=r?0:4;e.setUint32(t+f,c,r),e.setUint32(t+u,i,r)}function Jn(e,t,n){return e&t^~e&n}function tr(e,t,n){return e&t^e&n^t&n}var Wt=class extends Zt{constructor(t,n,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Pt(this.buffer)}update(t){zt(this),t=Lt(t),Z(t);let{view:n,buffer:r,blockLen:o}=this,s=t.length;for(let c=0;c<s;){let i=Math.min(o-this.pos,s-c);if(i===o){let f=Pt(t);for(;o<=s-c;c+=o)this.process(f,c);continue}r.set(t.subarray(c,c+i),this.pos),this.pos+=i,c+=i,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){zt(this),$n(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:c}=this;n[c++]=128,W(this.buffer.subarray(c)),this.padOffset>o-c&&(this.process(r,0),c=0);for(let l=c;l<o;l++)n[l]=0;Fo(r,o-8,BigInt(this.length*8),s),this.process(r,0);let i=Pt(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=f/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)i.setUint32(4*l,h[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:c,pos:i}=this;return t.destroyed=c,t.finished=s,t.length=o,t.pos=i,o%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}},bt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var z=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var le=BigInt(4294967295),er=BigInt(32);function jo(e,t=!1){return t?{h:Number(e&le),l:Number(e>>er&le)}:{h:Number(e>>er&le)|0,l:Number(e&le)|0}}function nr(e,t=!1){let n=e.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){let{h:c,l:i}=jo(e[s],t);[r[s],o[s]]=[c,i]}return[r,o]}var Ve=(e,t,n)=>e>>>n,Xe=(e,t,n)=>e<<32-n|t>>>n,kt=(e,t,n)=>e>>>n|t<<32-n,Mt=(e,t,n)=>e<<32-n|t>>>n,Qt=(e,t,n)=>e<<64-n|t>>>n-32,Jt=(e,t,n)=>e>>>n-32|t<<64-n;function ut(e,t,n,r){let o=(t>>>0)+(r>>>0);return{h:e+n+(o/2**32|0)|0,l:o|0}}var rr=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),or=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,sr=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),ir=(e,t,n,r,o)=>t+n+r+o+(e/2**32|0)|0,cr=(e,t,n,r,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(o>>>0),fr=(e,t,n,r,o,s)=>t+n+r+o+s+(e/2**32|0)|0;var Zo=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_t=new Uint32Array(64),Ye=class extends Wt{constructor(t=32){super(64,t,8,!1),this.A=bt[0]|0,this.B=bt[1]|0,this.C=bt[2]|0,this.D=bt[3]|0,this.E=bt[4]|0,this.F=bt[5]|0,this.G=bt[6]|0,this.H=bt[7]|0}get(){let{A:t,B:n,C:r,D:o,E:s,F:c,G:i,H:f}=this;return[t,n,r,o,s,c,i,f]}set(t,n,r,o,s,c,i,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=c|0,this.G=i|0,this.H=f|0}process(t,n){for(let l=0;l<16;l++,n+=4)_t[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let a=_t[l-15],p=_t[l-2],y=rt(a,7)^rt(a,18)^a>>>3,x=rt(p,17)^rt(p,19)^p>>>10;_t[l]=x+_t[l-7]+y+_t[l-16]|0}let{A:r,B:o,C:s,D:c,E:i,F:f,G:u,H:h}=this;for(let l=0;l<64;l++){let a=rt(i,6)^rt(i,11)^rt(i,25),p=h+a+Jn(i,f,u)+Zo[l]+_t[l]|0,x=(rt(r,2)^rt(r,13)^rt(r,22))+tr(r,o,s)|0;h=u,u=f,f=i,i=c+p|0,c=s,s=o,o=r,r=p+x|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,c=c+this.D|0,i=i+this.E|0,f=f+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(r,o,s,c,i,f,u,h)}roundClean(){W(_t)}destroy(){this.set(0,0,0,0,0,0,0,0),W(this.buffer)}};var ar=nr(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),zo=ar[0],Po=ar[1],Tt=new Uint32Array(80),Ct=new Uint32Array(80),$e=class extends Wt{constructor(t=64){super(128,t,16,!1),this.Ah=z[0]|0,this.Al=z[1]|0,this.Bh=z[2]|0,this.Bl=z[3]|0,this.Ch=z[4]|0,this.Cl=z[5]|0,this.Dh=z[6]|0,this.Dl=z[7]|0,this.Eh=z[8]|0,this.El=z[9]|0,this.Fh=z[10]|0,this.Fl=z[11]|0,this.Gh=z[12]|0,this.Gl=z[13]|0,this.Hh=z[14]|0,this.Hl=z[15]|0}get(){let{Ah:t,Al:n,Bh:r,Bl:o,Ch:s,Cl:c,Dh:i,Dl:f,Eh:u,El:h,Fh:l,Fl:a,Gh:p,Gl:y,Hh:x,Hl:d}=this;return[t,n,r,o,s,c,i,f,u,h,l,a,p,y,x,d]}set(t,n,r,o,s,c,i,f,u,h,l,a,p,y,x,d){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=c|0,this.Dh=i|0,this.Dl=f|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=a|0,this.Gh=p|0,this.Gl=y|0,this.Hh=x|0,this.Hl=d|0}process(t,n){for(let m=0;m<16;m++,n+=4)Tt[m]=t.getUint32(n),Ct[m]=t.getUint32(n+=4);for(let m=16;m<80;m++){let v=Tt[m-15]|0,M=Ct[m-15]|0,_=kt(v,M,1)^kt(v,M,8)^Ve(v,M,7),T=Mt(v,M,1)^Mt(v,M,8)^Xe(v,M,7),R=Tt[m-2]|0,U=Ct[m-2]|0,C=kt(R,U,19)^Qt(R,U,61)^Ve(R,U,6),b=Mt(R,U,19)^Jt(R,U,61)^Xe(R,U,6),B=sr(T,b,Ct[m-7],Ct[m-16]),w=ir(B,_,C,Tt[m-7],Tt[m-16]);Tt[m]=w|0,Ct[m]=B|0}let{Ah:r,Al:o,Bh:s,Bl:c,Ch:i,Cl:f,Dh:u,Dl:h,Eh:l,El:a,Fh:p,Fl:y,Gh:x,Gl:d,Hh:g,Hl:E}=this;for(let m=0;m<80;m++){let v=kt(l,a,14)^kt(l,a,18)^Qt(l,a,41),M=Mt(l,a,14)^Mt(l,a,18)^Jt(l,a,41),_=l&p^~l&x,T=a&y^~a&d,R=cr(E,M,T,Po[m],Ct[m]),U=fr(R,g,v,_,zo[m],Tt[m]),C=R|0,b=kt(r,o,28)^Qt(r,o,34)^Qt(r,o,39),B=Mt(r,o,28)^Jt(r,o,34)^Jt(r,o,39),w=r&s^r&i^s&i,S=o&c^o&f^c&f;g=x|0,E=d|0,x=p|0,d=y|0,p=l|0,y=a|0,{h:l,l:a}=ut(u|0,h|0,U|0,C|0),u=i|0,h=f|0,i=s|0,f=c|0,s=r|0,c=o|0;let L=rr(C,B,S);r=or(L,U,b,w),o=L|0}({h:r,l:o}=ut(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:c}=ut(this.Bh|0,this.Bl|0,s|0,c|0),{h:i,l:f}=ut(this.Ch|0,this.Cl|0,i|0,f|0),{h:u,l:h}=ut(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:a}=ut(this.Eh|0,this.El|0,l|0,a|0),{h:p,l:y}=ut(this.Fh|0,this.Fl|0,p|0,y|0),{h:x,l:d}=ut(this.Gh|0,this.Gl|0,x|0,d|0),{h:g,l:E}=ut(this.Hh|0,this.Hl|0,g|0,E|0),this.set(r,o,s,c,i,f,u,h,l,a,p,y,x,d,g,E)}roundClean(){W(Tt,Ct)}destroy(){W(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Q=Ze(()=>new Ye);var ur=Ze(()=>new $e);function tn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Vo(e,...t){if(!tn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function pr(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function Xo(e){if(typeof e!="function")throw new Error("function expected");return!0}function Dt(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function en(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function We(e){if(!Array.isArray(e))throw new Error("array expected")}function de(e,t){if(!pr(!0,t))throw new Error(`${e}: array of strings expected`)}function xr(e,t){if(!pr(!1,t))throw new Error(`${e}: array of numbers expected`)}function nn(...e){let t=s=>s,n=(s,c)=>i=>s(c(i)),r=e.map(s=>s.encode).reduceRight(n,t),o=e.map(s=>s.decode).reduce(n,t);return{encode:r,decode:o}}function rn(e){let t=typeof e=="string"?e.split(""):e,n=t.length;de("alphabet",t);let r=new Map(t.map((o,s)=>[o,s]));return{encode:o=>(We(o),o.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:o=>(We(o),o.map(s=>{Dt("alphabet.decode",s);let c=r.get(s);if(c===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return c}))}}function on(e=""){return Dt("join",e),{encode:t=>(de("join.decode",t),t.join(e)),decode:t=>(Dt("join.decode",t),t.split(e))}}function Yo(e,t="="){return en(e),Dt("padding",t),{encode(n){for(de("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){de("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}var yr=(e,t)=>t===0?e:yr(t,e%t),pe=(e,t)=>e+(t-yr(e,t)),he=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function Qe(e,t,n,r){if(We(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(pe(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${pe(t,n)}`);let o=0,s=0,c=he[t],i=he[n]-1,f=[];for(let u of e){if(en(u),u>=c)throw new Error(`convertRadix2: invalid data word=${u} from=${t}`);if(o=o<<t|u,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)f.push((o>>s-n&i)>>>0);let h=he[s];if(h===void 0)throw new Error("invalid carry");o&=h-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o>0)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&f.push(o>>>0),f}function sn(e,t=!1){if(en(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(pe(8,e)>32||pe(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!tn(n))throw new Error("radix2.encode input should be Uint8Array");return Qe(Array.from(n),8,e,!t)},decode:n=>(xr("radix2.decode",n),Uint8Array.from(Qe(n,e,8,t)))}}function lr(e){return Xo(e),function(...t){try{return e.apply(null,t)}catch{}}}var $o=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",Wo=(e,t)=>{Dt("base64",e);let n=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=t?"base64url":"base64";if(e.length>0&&!n.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:r,lastChunkHandling:"strict"})},cn=$o?{encode(e){return Vo(e),e.toBase64()},decode(e){return Wo(e,!1)}}:nn(sn(6),rn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Yo(6),on("")),et=nn(sn(6),rn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),on(""));var Je=nn(rn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),on("")),hr=[996825010,642813549,513874426,1027748829,705979059];function te(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<hr.length;r++)(t>>r&1)===1&&(n^=hr[r]);return n}function dr(e,t,n=1){let r=e.length,o=1;for(let s=0;s<r;s++){let c=e.charCodeAt(s);if(c<33||c>126)throw new Error(`Invalid prefix (${e})`);o=te(o)^c>>5}o=te(o);for(let s=0;s<r;s++)o=te(o)^e.charCodeAt(s)&31;for(let s of t)o=te(o)^s;for(let s=0;s<6;s++)o=te(o);return o^=n,Je.encode(Qe([o%he[30]],30,5,!1))}function Qo(e){let t=e==="bech32"?1:734539939,n=sn(5),r=n.decode,o=n.encode,s=lr(r);function c(l,a,p=90){Dt("bech32.encode prefix",l),tn(a)&&(a=Array.from(a)),xr("bech32.encode",a);let y=l.length;if(y===0)throw new TypeError(`Invalid prefix length ${y}`);let x=y+7+a.length;if(p!==!1&&x>p)throw new TypeError(`Length ${x} exceeds limit ${p}`);let d=l.toLowerCase(),g=dr(d,a,t);return`${d}1${Je.encode(a)}${g}`}function i(l,a=90){Dt("bech32.decode input",l);let p=l.length;if(p<8||a!==!1&&p>a)throw new TypeError(`invalid string length: ${p} (${l}). Expected (8..${a})`);let y=l.toLowerCase();if(l!==y&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");let x=y.lastIndexOf("1");if(x===0||x===-1)throw new Error('Letter "1" must be present between prefix and data only');let d=y.slice(0,x),g=y.slice(x+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");let E=Je.decode(g).slice(0,-6),m=dr(d,E,t);if(!g.endsWith(m))throw new Error(`Invalid checksum in ${l}: expected "${m}"`);return{prefix:d,words:E}}let f=lr(i);function u(l){let{prefix:a,words:p}=i(l,!1);return{prefix:a,words:p,bytes:r(p)}}function h(l,a){return c(l,o(a))}return{encode:c,decode:i,encodeFromBytes:h,decodeToBytes:u,decodeUnsafe:f,fromWords:r,fromWordsUnsafe:s,toWords:o}}var lt=Qo("bech32");function ts(e,t,n,r){Rt(e);let o=ae({dkLen:32,asyncTick:10},r),{c:s,dkLen:c,asyncTick:i}=o;if(G(s),G(c),G(i),s<1)throw new Error("iterations (c) should be >= 1");let f=Ge(t),u=Ge(n),h=new Uint8Array(c),l=wt.create(e,f),a=l._cloneInto().update(u);return{c:s,dkLen:c,asyncTick:i,DK:h,PRF:l,PRFSalt:a}}function es(e,t,n,r,o){return e.destroy(),t.destroy(),r&&r.destroy(),W(o),n}function fn(e,t,n,r){let{c:o,dkLen:s,DK:c,PRF:i,PRFSalt:f}=ts(e,t,n,r),u,h=new Uint8Array(4),l=Pt(h),a=new Uint8Array(i.outputLen);for(let p=1,y=0;y<s;p++,y+=i.outputLen){let x=c.subarray(y,y+i.outputLen);l.setInt32(0,p,!1),(u=f._cloneInto(u)).update(h).digestInto(a),x.set(a.subarray(0,x.length));for(let d=1;d<o;d++){i._cloneInto(u).update(a).digestInto(a);for(let g=0;g<x.length;g++)x[g]^=a[g]}}return es(i,f,c,u,a)}function gr(e,t,n,r,o,s){let c=e[t++]^n[r++],i=e[t++]^n[r++],f=e[t++]^n[r++],u=e[t++]^n[r++],h=e[t++]^n[r++],l=e[t++]^n[r++],a=e[t++]^n[r++],p=e[t++]^n[r++],y=e[t++]^n[r++],x=e[t++]^n[r++],d=e[t++]^n[r++],g=e[t++]^n[r++],E=e[t++]^n[r++],m=e[t++]^n[r++],v=e[t++]^n[r++],M=e[t++]^n[r++],_=c,T=i,R=f,U=u,C=h,b=l,B=a,w=p,S=y,L=x,H=d,O=g,N=E,A=m,k=v,D=M;for(let q=0;q<8;q+=2)C^=K(_+N|0,7),S^=K(C+_|0,9),N^=K(S+C|0,13),_^=K(N+S|0,18),L^=K(b+T|0,7),A^=K(L+b|0,9),T^=K(A+L|0,13),b^=K(T+A|0,18),k^=K(H+B|0,7),R^=K(k+H|0,9),B^=K(R+k|0,13),H^=K(B+R|0,18),U^=K(D+O|0,7),w^=K(U+D|0,9),O^=K(w+U|0,13),D^=K(O+w|0,18),T^=K(_+U|0,7),R^=K(T+_|0,9),U^=K(R+T|0,13),_^=K(U+R|0,18),B^=K(b+C|0,7),w^=K(B+b|0,9),C^=K(w+B|0,13),b^=K(C+w|0,18),O^=K(H+L|0,7),S^=K(O+H|0,9),L^=K(S+O|0,13),H^=K(L+S|0,18),N^=K(D+k|0,7),A^=K(N+D|0,9),k^=K(A+N|0,13),D^=K(k+A|0,18);o[s++]=c+_|0,o[s++]=i+T|0,o[s++]=f+R|0,o[s++]=u+U|0,o[s++]=h+C|0,o[s++]=l+b|0,o[s++]=a+B|0,o[s++]=p+w|0,o[s++]=y+S|0,o[s++]=x+L|0,o[s++]=d+H|0,o[s++]=g+O|0,o[s++]=E+N|0,o[s++]=m+A|0,o[s++]=v+k|0,o[s++]=M+D|0}function an(e,t,n,r,o){let s=r+0,c=r+16*o;for(let i=0;i<16;i++)n[c+i]=e[t+(2*o-1)*16+i];for(let i=0;i<o;i++,s+=16,t+=16)gr(n,c,e,t,n,s),i>0&&(c+=16),gr(n,s,e,t+=16,n,c)}function ns(e,t,n){let r=ae({dkLen:32,asyncTick:10,maxmem:1073742848},n),{N:o,r:s,p:c,dkLen:i,asyncTick:f,maxmem:u,onProgress:h}=r;if(G(o),G(s),G(c),G(i),G(f),G(u),h!==void 0&&typeof h!="function")throw new Error("progressCb should be function");let l=128*s,a=l/4,p=Math.pow(2,32);if(o<=1||(o&o-1)!==0||o>p)throw new Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(c<0||c>(p-1)*32/l)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(i<0||i>(p-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(l*(o+c)>u)throw new Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+u);let x=fn(Q,e,t,{c:1,dkLen:l*c}),d=ie(x),g=ie(new Uint8Array(l*o)),E=ie(new Uint8Array(l)),m=()=>{};if(h){let v=2*o*c,M=Math.max(Math.floor(v/1e4),1),_=0;m=()=>{_++,h&&(!(_%M)||_===v)&&h(_/v)}}return{N:o,r:s,p:c,dkLen:i,blockSize32:a,V:g,B32:d,B:x,tmp:E,blockMixCb:m,asyncTick:f}}function rs(e,t,n,r,o){let s=fn(Q,e,n,{c:1,dkLen:t});return W(n,r,o),s}function un(e,t,n){let{N:r,r:o,p:s,dkLen:c,blockSize32:i,V:f,B32:u,B:h,tmp:l,blockMixCb:a}=ns(e,t,n);je(u);for(let p=0;p<s;p++){let y=i*p;for(let x=0;x<i;x++)f[x]=u[y+x];for(let x=0,d=0;x<r-1;x++)an(f,d,f,d+=i,o),a();an(f,(r-1)*i,u,y,o),a();for(let x=0;x<r;x++){let d=u[y+i-16]%r;for(let g=0;g<i;g++)l[g]=u[y+g]^f[d*i+g];an(l,0,u,y,o),a()}}return je(u),rs(e,c,h,f,l)}function br(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function xe(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function ye(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Y(e,...t){if(!br(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ln(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function mr(e,t){Y(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function mt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Et(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function os(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}var ss=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function is(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function ge(e){if(typeof e=="string")e=is(e);else if(br(e))e=we(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function Er(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Br(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var hn=(e,t)=>{function n(r,...o){if(Y(r),!ss)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){let h=o[0];if(!h)throw new Error("nonce / iv required");e.varSizeNonce?Y(h):Y(h,e.nonceLength)}let s=e.tagLength;s&&o[1]!==void 0&&Y(o[1]);let c=t(r,...o),i=(h,l)=>{if(l!==void 0){if(h!==2)throw new Error("cipher output not supported");Y(l)}},f=!1;return{encrypt(h,l){if(f)throw new Error("cannot encrypt() twice with same key + nonce");return f=!0,Y(h),i(c.encrypt.length,l),c.encrypt(h,l)},decrypt(h,l){if(Y(h),s&&h.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return i(c.decrypt.length,l),c.decrypt(h,l)}}}return Object.assign(n,e),n};function dn(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!cs(t))throw new Error("invalid output, must be aligned");return t}function wr(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),c=Number(n>>o&s),i=Number(n&s),f=r?4:0,u=r?0:4;e.setUint32(t+f,c,r),e.setUint32(t+u,i,r)}function Ar(e,t,n){xe(n);let r=new Uint8Array(16),o=os(r);return wr(o,0,BigInt(t),n),wr(o,8,BigInt(e),n),r}function cs(e){return e.byteOffset%4===0}function we(e){return Uint8Array.from(e)}var vr=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),fs=vr("expand 16-byte k"),as=vr("expand 32-byte k"),us=mt(fs),ls=mt(as);function I(e,t){return e<<t|e>>>32-t}function pn(e){return e.byteOffset%4===0}var be=64,hs=16,Ir=2**32-1,Sr=new Uint32Array;function ds(e,t,n,r,o,s,c,i){let f=o.length,u=new Uint8Array(be),h=mt(u),l=pn(o)&&pn(s),a=l?mt(o):Sr,p=l?mt(s):Sr;for(let y=0;y<f;c++){if(e(t,n,r,h,c,i),c>=Ir)throw new Error("arx: counter overflow");let x=Math.min(be,f-y);if(l&&x===be){let d=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let g=0,E;g<hs;g++)E=d+g,p[E]=a[E]^h[g];y+=be;continue}for(let d=0,g;d<x;d++)g=y+d,s[g]=o[g]^u[d];y+=x}}function xn(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:c}=Er({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return ye(o),ye(c),xe(s),xe(n),(i,f,u,h,l=0)=>{Y(i),Y(f),Y(u);let a=u.length;if(h===void 0&&(h=new Uint8Array(a)),Y(h),ye(l),l<0||l>=Ir)throw new Error("arx: counter overflow");if(h.length<a)throw new Error(`arx: output (${h.length}) is shorter than data (${a})`);let p=[],y=i.length,x,d;if(y===32)p.push(x=we(i)),d=ls;else if(y===16&&n)x=new Uint8Array(32),x.set(i),x.set(i,16),d=us,p.push(x);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);pn(f)||p.push(f=we(f));let g=mt(x);if(r){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,g,mt(f.subarray(0,16)),g),f=f.subarray(16)}let E=16-o;if(E!==f.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){let v=new Uint8Array(12);v.set(f,s?0:12-f.length),f=v,p.push(f)}let m=mt(f);return ds(e,d,g,m,u,h,l,c),Et(...p),h}}var P=(e,t)=>e[t++]&255|(e[t++]&255)<<8,yn=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=ge(t),Y(t,32);let n=P(t,0),r=P(t,2),o=P(t,4),s=P(t,6),c=P(t,8),i=P(t,10),f=P(t,12),u=P(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|i<<2)&8191,this.r[7]=(i>>>11|f<<5)&8065,this.r[8]=(f>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let h=0;h<8;h++)this.pad[h]=P(t,16+2*h)}process(t,n,r=!1){let o=r?0:2048,{h:s,r:c}=this,i=c[0],f=c[1],u=c[2],h=c[3],l=c[4],a=c[5],p=c[6],y=c[7],x=c[8],d=c[9],g=P(t,n+0),E=P(t,n+2),m=P(t,n+4),v=P(t,n+6),M=P(t,n+8),_=P(t,n+10),T=P(t,n+12),R=P(t,n+14),U=s[0]+(g&8191),C=s[1]+((g>>>13|E<<3)&8191),b=s[2]+((E>>>10|m<<6)&8191),B=s[3]+((m>>>7|v<<9)&8191),w=s[4]+((v>>>4|M<<12)&8191),S=s[5]+(M>>>1&8191),L=s[6]+((M>>>14|_<<2)&8191),H=s[7]+((_>>>11|T<<5)&8191),O=s[8]+((T>>>8|R<<8)&8191),N=s[9]+(R>>>5|o),A=0,k=A+U*i+C*(5*d)+b*(5*x)+B*(5*y)+w*(5*p);A=k>>>13,k&=8191,k+=S*(5*a)+L*(5*l)+H*(5*h)+O*(5*u)+N*(5*f),A+=k>>>13,k&=8191;let D=A+U*f+C*i+b*(5*d)+B*(5*x)+w*(5*y);A=D>>>13,D&=8191,D+=S*(5*p)+L*(5*a)+H*(5*l)+O*(5*h)+N*(5*u),A+=D>>>13,D&=8191;let q=A+U*u+C*f+b*i+B*(5*d)+w*(5*x);A=q>>>13,q&=8191,q+=S*(5*y)+L*(5*p)+H*(5*a)+O*(5*l)+N*(5*h),A+=q>>>13,q&=8191;let tt=A+U*h+C*u+b*f+B*i+w*(5*d);A=tt>>>13,tt&=8191,tt+=S*(5*x)+L*(5*y)+H*(5*p)+O*(5*a)+N*(5*l),A+=tt>>>13,tt&=8191;let it=A+U*l+C*h+b*u+B*f+w*i;A=it>>>13,it&=8191,it+=S*(5*d)+L*(5*x)+H*(5*y)+O*(5*p)+N*(5*a),A+=it>>>13,it&=8191;let ct=A+U*a+C*l+b*h+B*u+w*f;A=ct>>>13,ct&=8191,ct+=S*i+L*(5*d)+H*(5*x)+O*(5*y)+N*(5*p),A+=ct>>>13,ct&=8191;let ft=A+U*p+C*a+b*l+B*h+w*u;A=ft>>>13,ft&=8191,ft+=S*f+L*i+H*(5*d)+O*(5*x)+N*(5*y),A+=ft>>>13,ft&=8191;let at=A+U*y+C*p+b*a+B*l+w*h;A=at>>>13,at&=8191,at+=S*u+L*f+H*i+O*(5*d)+N*(5*x),A+=at>>>13,at&=8191;let xt=A+U*x+C*y+b*p+B*a+w*l;A=xt>>>13,xt&=8191,xt+=S*h+L*u+H*f+O*i+N*(5*d),A+=xt>>>13,xt&=8191;let yt=A+U*d+C*x+b*y+B*p+w*a;A=yt>>>13,yt&=8191,yt+=S*l+L*h+H*u+O*f+N*i,A+=yt>>>13,yt&=8191,A=(A<<2)+A|0,A=A+k|0,k=A&8191,A=A>>>13,D+=A,s[0]=k,s[1]=D,s[2]=q,s[3]=tt,s[4]=it,s[5]=ct,s[6]=ft,s[7]=at,s[8]=xt,s[9]=yt}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let i=2;i<10;i++)t[i]+=o,o=t[i]>>>13,t[i]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let i=1;i<10;i++)r[i]=t[i]+o,o=r[i]>>>13,r[i]&=8191;r[9]-=8192;let s=(o^1)-1;for(let i=0;i<10;i++)r[i]&=s;s=~s;for(let i=0;i<10;i++)t[i]=t[i]&s|r[i];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let c=t[0]+n[0];t[0]=c&65535;for(let i=1;i<8;i++)c=(t[i]+n[i]|0)+(c>>>16)|0,t[i]=c&65535;Et(r)}update(t){ln(this),t=ge(t),Y(t);let{buffer:n,blockLen:r}=this,o=t.length;for(let s=0;s<o;){let c=Math.min(r-this.pos,o-s);if(c===r){for(;r<=o-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Et(this.h,this.r,this.buffer,this.pad)}digestInto(t){ln(this),mr(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let c=0;c<8;c++)t[s++]=r[c]>>>0,t[s++]=r[c]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function ps(e){let t=(r,o)=>e(o).update(ge(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var Lr=ps(e=>new yn(e));function Tr(e,t,n,r,o,s=20){let c=e[0],i=e[1],f=e[2],u=e[3],h=t[0],l=t[1],a=t[2],p=t[3],y=t[4],x=t[5],d=t[6],g=t[7],E=o,m=n[0],v=n[1],M=n[2],_=c,T=i,R=f,U=u,C=h,b=l,B=a,w=p,S=y,L=x,H=d,O=g,N=E,A=m,k=v,D=M;for(let tt=0;tt<s;tt+=2)_=_+C|0,N=I(N^_,16),S=S+N|0,C=I(C^S,12),_=_+C|0,N=I(N^_,8),S=S+N|0,C=I(C^S,7),T=T+b|0,A=I(A^T,16),L=L+A|0,b=I(b^L,12),T=T+b|0,A=I(A^T,8),L=L+A|0,b=I(b^L,7),R=R+B|0,k=I(k^R,16),H=H+k|0,B=I(B^H,12),R=R+B|0,k=I(k^R,8),H=H+k|0,B=I(B^H,7),U=U+w|0,D=I(D^U,16),O=O+D|0,w=I(w^O,12),U=U+w|0,D=I(D^U,8),O=O+D|0,w=I(w^O,7),_=_+b|0,D=I(D^_,16),H=H+D|0,b=I(b^H,12),_=_+b|0,D=I(D^_,8),H=H+D|0,b=I(b^H,7),T=T+B|0,N=I(N^T,16),O=O+N|0,B=I(B^O,12),T=T+B|0,N=I(N^T,8),O=O+N|0,B=I(B^O,7),R=R+w|0,A=I(A^R,16),S=S+A|0,w=I(w^S,12),R=R+w|0,A=I(A^R,8),S=S+A|0,w=I(w^S,7),U=U+C|0,k=I(k^U,16),L=L+k|0,C=I(C^L,12),U=U+C|0,k=I(k^U,8),L=L+k|0,C=I(C^L,7);let q=0;r[q++]=c+_|0,r[q++]=i+T|0,r[q++]=f+R|0,r[q++]=u+U|0,r[q++]=h+C|0,r[q++]=l+b|0,r[q++]=a+B|0,r[q++]=p+w|0,r[q++]=y+S|0,r[q++]=x+L|0,r[q++]=d+H|0,r[q++]=g+O|0,r[q++]=E+N|0,r[q++]=m+A|0,r[q++]=v+k|0,r[q++]=M+D|0}function xs(e,t,n,r){let o=e[0],s=e[1],c=e[2],i=e[3],f=t[0],u=t[1],h=t[2],l=t[3],a=t[4],p=t[5],y=t[6],x=t[7],d=n[0],g=n[1],E=n[2],m=n[3];for(let M=0;M<20;M+=2)o=o+f|0,d=I(d^o,16),a=a+d|0,f=I(f^a,12),o=o+f|0,d=I(d^o,8),a=a+d|0,f=I(f^a,7),s=s+u|0,g=I(g^s,16),p=p+g|0,u=I(u^p,12),s=s+u|0,g=I(g^s,8),p=p+g|0,u=I(u^p,7),c=c+h|0,E=I(E^c,16),y=y+E|0,h=I(h^y,12),c=c+h|0,E=I(E^c,8),y=y+E|0,h=I(h^y,7),i=i+l|0,m=I(m^i,16),x=x+m|0,l=I(l^x,12),i=i+l|0,m=I(m^i,8),x=x+m|0,l=I(l^x,7),o=o+u|0,m=I(m^o,16),y=y+m|0,u=I(u^y,12),o=o+u|0,m=I(m^o,8),y=y+m|0,u=I(u^y,7),s=s+h|0,d=I(d^s,16),x=x+d|0,h=I(h^x,12),s=s+h|0,d=I(d^s,8),x=x+d|0,h=I(h^x,7),c=c+l|0,g=I(g^c,16),a=a+g|0,l=I(l^a,12),c=c+l|0,g=I(g^c,8),a=a+g|0,l=I(l^a,7),i=i+f|0,E=I(E^i,16),p=p+E|0,f=I(f^p,12),i=i+f|0,E=I(E^i,8),p=p+E|0,f=I(f^p,7);let v=0;r[v++]=o,r[v++]=s,r[v++]=c,r[v++]=i,r[v++]=d,r[v++]=g,r[v++]=E,r[v++]=m}var ys=xn(Tr,{counterRight:!1,counterLength:4,allowShortKeys:!1}),gs=xn(Tr,{counterRight:!1,counterLength:8,extendNonceFn:xs,allowShortKeys:!1});var ws=new Uint8Array(16),Ur=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(ws.subarray(n))},bs=new Uint8Array(32);function _r(e,t,n,r,o){let s=e(t,n,bs),c=Lr.create(s);o&&Ur(c,o),Ur(c,r);let i=Ar(r.length,o?o.length:0,!0);c.update(i);let f=c.digest();return Et(s,i),f}var Cr=e=>(t,n,r)=>({encrypt(s,c){let i=s.length;c=dn(i+16,c,!1),c.set(s);let f=c.subarray(0,-16);e(t,n,f,f,1);let u=_r(e,t,n,f,r);return c.set(u,i),Et(u),c},decrypt(s,c){c=dn(s.length-16,c,!1);let i=s.subarray(0,-16),f=s.subarray(-16),u=_r(e,t,n,i,r);if(!Br(f,u))throw new Error("invalid tag");return c.set(s.subarray(0,-16)),e(t,n,c,c,1),Et(u),c}}),Ht=hn({blockSize:64,nonceLength:12,tagLength:16},Cr(ys)),Pi=hn({blockSize:64,nonceLength:24,tagLength:16},Cr(gs));var bn=BigInt(0),wn=BigInt(1);function me(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function Hr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?bn:BigInt("0x"+e)}function Or(e){return Hr(Nt(e))}function ot(e){return Z(e),Hr(Nt(Uint8Array.from(e).reverse()))}function mn(e,t){return ce(e.toString(16).padStart(t*2,"0"))}function ht(e,t){return mn(e,t).reverse()}function V(e,t,n){let r;if(typeof t=="string")try{r=ce(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(se(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(e+" of length "+n+" expected, got "+o);return r}function Rr(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var gn=e=>typeof e=="bigint"&&bn<=e;function ms(e,t,n){return gn(e)&&gn(t)&&gn(n)&&t<=e&&e<n}function Bt(e,t,n,r){if(!ms(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Nr(e){let t;for(t=0;e>bn;e>>=wn,t+=1);return t}var ee=e=>(wn<<BigInt(e))-wn;function qt(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(o,s,c){let i=e[o];if(c&&i===void 0)return;let f=typeof i;if(f!==s||i===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${f}`)}Object.entries(t).forEach(([o,s])=>r(o,s,!1)),Object.entries(n).forEach(([o,s])=>r(o,s,!0))}function En(e){let t=new WeakMap;return(n,...r)=>{let o=t.get(n);if(o!==void 0)return o;let s=e(n,...r);return t.set(n,s),s}}var J=BigInt(0),$=BigInt(1),Kt=BigInt(2),Dr=BigInt(3),qr=BigInt(4),Kr=BigInt(5),Es=BigInt(7),Fr=BigInt(8),Bs=BigInt(9),jr=BigInt(16);function F(e,t){let n=e%t;return n>=J?n:t+n}function nt(e,t,n){let r=e;for(;t-- >J;)r*=r,r%=n;return r}function kr(e,t){if(e===J)throw new Error("invert: expected non-zero number");if(t<=J)throw new Error("invert: expected positive modulus, got "+t);let n=F(e,t),r=t,o=J,s=$,c=$,i=J;for(;n!==J;){let u=r/n,h=r%n,l=o-c*u,a=s-i*u;r=n,n=h,o=c,s=i,c=l,i=a}if(r!==$)throw new Error("invert: does not exist");return F(o,t)}function Bn(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function Gr(e,t){let n=(e.ORDER+$)/qr,r=e.pow(t,n);return Bn(e,r,t),r}function As(e,t){let n=(e.ORDER-Kr)/Fr,r=e.mul(t,Kt),o=e.pow(r,n),s=e.mul(t,o),c=e.mul(e.mul(s,Kt),o),i=e.mul(s,e.sub(c,e.ONE));return Bn(e,i,t),i}function Ss(e){let t=St(e),n=Zr(e),r=n(t,t.neg(t.ONE)),o=n(t,r),s=n(t,t.neg(r)),c=(e+Es)/jr;return(i,f)=>{let u=i.pow(f,c),h=i.mul(u,r),l=i.mul(u,o),a=i.mul(u,s),p=i.eql(i.sqr(h),f),y=i.eql(i.sqr(l),f);u=i.cmov(u,h,p),h=i.cmov(a,l,y);let x=i.eql(i.sqr(h),f),d=i.cmov(u,h,x);return Bn(i,d,f),d}}function Zr(e){if(e<Dr)throw new Error("sqrt is not defined for small field");let t=e-$,n=0;for(;t%Kt===J;)t/=Kt,n++;let r=Kt,o=St(e);for(;Mr(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Gr;let s=o.pow(r,t),c=(t+$)/Kt;return function(f,u){if(f.is0(u))return u;if(Mr(f,u)!==1)throw new Error("Cannot find square root");let h=n,l=f.mul(f.ONE,s),a=f.pow(u,t),p=f.pow(u,c);for(;!f.eql(a,f.ONE);){if(f.is0(a))return f.ZERO;let y=1,x=f.sqr(a);for(;!f.eql(x,f.ONE);)if(y++,x=f.sqr(x),y===h)throw new Error("Cannot find square root");let d=$<<BigInt(h-y-1),g=f.pow(l,d);h=y,l=f.sqr(g),a=f.mul(a,l),p=f.mul(p,g)}return p}}function vs(e){return e%qr===Dr?Gr:e%Fr===Kr?As:e%jr===Bs?Ss(e):Zr(e)}var At=(e,t)=>(F(e,t)&$)===$,Is=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zr(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=Is.reduce((r,o)=>(r[o]="function",r),t);return qt(e,n),e}function Ls(e,t,n){if(n<J)throw new Error("invalid exponent, negatives unsupported");if(n===J)return e.ONE;if(n===$)return t;let r=e.ONE,o=t;for(;n>J;)n&$&&(r=e.mul(r,o)),o=e.sqr(o),n>>=$;return r}function Ee(e,t,n=!1){let r=new Array(t.length).fill(n?e.ZERO:void 0),o=t.reduce((c,i,f)=>e.is0(i)?c:(r[f]=c,e.mul(c,i)),e.ONE),s=e.inv(o);return t.reduceRight((c,i,f)=>e.is0(i)?c:(r[f]=e.mul(c,r[f]),e.mul(c,i)),s),r}function Mr(e,t){let n=(e.ORDER-$)/Kt,r=e.pow(t,n),o=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),c=e.eql(r,e.neg(e.ONE));if(!o&&!s&&!c)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Pr(e,t){t!==void 0&&G(t);let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function St(e,t,n=!1,r={}){if(e<=J)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s,c=!1,i;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");let a=t;a.BITS&&(o=a.BITS),a.sqrt&&(s=a.sqrt),typeof a.isLE=="boolean"&&(n=a.isLE),typeof a.modOnDecode=="boolean"&&(c=a.modOnDecode),i=a.allowedLengths}else typeof t=="number"&&(o=t),r.sqrt&&(s=r.sqrt);let{nBitLength:f,nByteLength:u}=Pr(e,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h,l=Object.freeze({ORDER:e,isLE:n,BITS:f,BYTES:u,MASK:ee(f),ZERO:J,ONE:$,allowedLengths:i,create:a=>F(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof a);return J<=a&&a<e},is0:a=>a===J,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&$)===$,neg:a=>F(-a,e),eql:(a,p)=>a===p,sqr:a=>F(a*a,e),add:(a,p)=>F(a+p,e),sub:(a,p)=>F(a-p,e),mul:(a,p)=>F(a*p,e),pow:(a,p)=>Ls(l,a,p),div:(a,p)=>F(a*kr(p,e),e),sqrN:a=>a*a,addN:(a,p)=>a+p,subN:(a,p)=>a-p,mulN:(a,p)=>a*p,inv:a=>kr(a,e),sqrt:s||(a=>(h||(h=vs(e)),h(l,a))),toBytes:a=>n?ht(a,u):mn(a,u),fromBytes:(a,p=!0)=>{if(i){if(!i.includes(a.length)||a.length>u)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+a.length);let x=new Uint8Array(u);x.set(a,n?0:x.length-a.length),a=x}if(a.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+a.length);let y=n?ot(a):Or(a);if(c&&(y=F(y,e)),!p&&!l.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y},invertBatch:a=>Ee(l,a),cmov:(a,p,y)=>y?p:a});return Object.freeze(l)}var Be=BigInt(0),In=BigInt(1);function Vr(e,t){let n=t.negate();return e?n:t}function ne(e,t){let n=Ee(e.Fp,t.map(r=>r.Z));return t.map((r,o)=>e.fromAffine(r.toAffine(n[o])))}function Wr(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function An(e,t){Wr(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),o=2**e,s=ee(e),c=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:c}}function Xr(e,t,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:c}=n,i=Number(e&o),f=e>>c;i>r&&(i-=s,f+=In);let u=t*r,h=u+Math.abs(i)-1,l=i===0,a=i<0,p=t%2!==0;return{nextN:f,offset:h,isZero:l,isNeg:a,isNegF:p,offsetF:u}}function Us(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function _s(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}var Sn=new WeakMap,Qr=new WeakMap;function vn(e){return Qr.get(e)||1}function Yr(e){if(e!==Be)throw new Error("invalid wNAF")}var Ae=class{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let o=t;for(;n>Be;)n&In&&(r=r.add(o)),o=o.double(),n>>=In;return r}precomputeWindow(t,n){let{windows:r,windowSize:o}=An(n,this.bits),s=[],c=t,i=c;for(let f=0;f<r;f++){i=c,s.push(i);for(let u=1;u<o;u++)i=i.add(c),s.push(i);c=i.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,c=An(t,this.bits);for(let i=0;i<c.windows;i++){let{nextN:f,offset:u,isZero:h,isNeg:l,isNegF:a,offsetF:p}=Xr(r,i,c);r=f,h?s=s.add(Vr(a,n[p])):o=o.add(Vr(l,n[u]))}return Yr(r),{p:o,f:s}}wNAFUnsafe(t,n,r,o=this.ZERO){let s=An(t,this.bits);for(let c=0;c<s.windows&&r!==Be;c++){let{nextN:i,offset:f,isZero:u,isNeg:h}=Xr(r,c,s);if(r=i,!u){let l=n[f];o=o.add(h?l.negate():l)}}return Yr(r),o}getPrecomputes(t,n,r){let o=Sn.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(o=r(o)),Sn.set(n,o))),o}cached(t,n,r){let o=vn(t);return this.wNAF(o,this.getPrecomputes(o,t,r),n)}unsafe(t,n,r,o){let s=vn(t);return s===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,o)}createCache(t,n){Wr(n,this.bits),Qr.set(t,n),Sn.delete(t)}hasCache(t){return vn(t)!==1}};function Se(e,t,n,r){Us(n,e),_s(r,t);let o=n.length,s=r.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let c=e.ZERO,i=Nr(BigInt(o)),f=1;i>12?f=i-3:i>4?f=i-2:i>0&&(f=2);let u=ee(f),h=new Array(Number(u)+1).fill(c),l=Math.floor((t.BITS-1)/f)*f,a=c;for(let p=l;p>=0;p-=f){h.fill(c);for(let x=0;x<s;x++){let d=r[x],g=Number(d>>BigInt(p)&u);h[g]=h[g].add(n[x])}let y=c;for(let x=h.length-1,d=c;x>0;x--)d=d.add(h[x]),y=y.add(d);if(a=a.add(y),p!==0)for(let x=0;x<f;x++)a=a.double()}return a}function $r(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return zr(t),t}else return St(e)}function Jr(e,t,n={}){if(!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let i of["p","n","h"]){let f=t[i];if(!(typeof f=="bigint"&&f>Be))throw new Error(`CURVE.${i} must be positive bigint`)}let r=$r(t.p,n.Fp),o=$r(t.n,n.Fn),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let i of c)if(!r.isValid(t[i]))throw new Error(`CURVE.${i} must be valid field element of CURVE.Fp`);return{Fp:r,Fn:o}}var dt=BigInt(0),j=BigInt(1),Ln=BigInt(2),Ts=BigInt(8);function Cs(e,t,n,r){let o=e.sqr(n),s=e.sqr(r),c=e.add(e.mul(t.a,o),s),i=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(c,i)}function Hs(e,t={}){let{Fp:n,Fn:r}=Jr("edwards",e,t),{h:o,n:s}=e;qt(t,{},{uvRatio:"function"});let c=Ln<<BigInt(r.BYTES*8)-j,i=x=>n.create(x),f=t.uvRatio||((x,d)=>{try{return{isValid:!0,value:n.sqrt(n.div(x,d))}}catch{return{isValid:!1,value:dt}}});if(!Cs(n,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function u(x,d,g=!1){let E=g?j:dt;return Bt("coordinate "+x,d,E,c),d}function h(x){if(!(x instanceof p))throw new Error("ExtendedPoint expected")}let l=En((x,d)=>{let{X:g,Y:E,Z:m}=x,v=x.is0();d==null&&(d=v?Ts:n.inv(m));let M=i(g*d),_=i(E*d),T=n.mul(m,d);if(v)return{x:dt,y:j};if(T!==j)throw new Error("invZ was invalid");return{x:M,y:_}}),a=En(x=>{let{a:d,d:g}=e;if(x.is0())throw new Error("bad point: ZERO");let{X:E,Y:m,Z:v,T:M}=x,_=i(E*E),T=i(m*m),R=i(v*v),U=i(R*R),C=i(_*d),b=i(R*i(C+T)),B=i(U+i(g*i(_*T)));if(b!==B)throw new Error("bad point: equation left != right (1)");let w=i(E*m),S=i(v*M);if(w!==S)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(d,g,E,m){this.X=u("x",d),this.Y=u("y",g),this.Z=u("z",E,!0),this.T=u("t",m),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(d){return ne(p,d)}static msm(d,g){return Se(p,r,d,g)}_setWindowSize(d){this.precompute(d)}static fromAffine(d){if(d instanceof p)throw new Error("extended point not allowed");let{x:g,y:E}=d||{};return u("x",g),u("y",E),new p(g,E,j,i(g*E))}precompute(d=8,g=!0){return y.createCache(this,d),g||this.multiply(Ln),this}assertValidity(){a(this)}equals(d){h(d);let{X:g,Y:E,Z:m}=this,{X:v,Y:M,Z:_}=d,T=i(g*_),R=i(v*m),U=i(E*_),C=i(M*m);return T===R&&U===C}is0(){return this.equals(p.ZERO)}negate(){return new p(i(-this.X),this.Y,this.Z,i(-this.T))}double(){let{a:d}=e,{X:g,Y:E,Z:m}=this,v=i(g*g),M=i(E*E),_=i(Ln*i(m*m)),T=i(d*v),R=g+E,U=i(i(R*R)-v-M),C=T+M,b=C-_,B=T-M,w=i(U*b),S=i(C*B),L=i(U*B),H=i(b*C);return new p(w,S,H,L)}add(d){h(d);let{a:g,d:E}=e,{X:m,Y:v,Z:M,T:_}=this,{X:T,Y:R,Z:U,T:C}=d,b=i(m*T),B=i(v*R),w=i(_*E*C),S=i(M*U),L=i((m+v)*(T+R)-b-B),H=S-w,O=S+w,N=i(B-g*b),A=i(L*H),k=i(O*N),D=i(L*N),q=i(H*O);return new p(A,k,q,D)}subtract(d){return this.add(d.negate())}multiply(d){let g=d;Bt("scalar",g,j,s);let{p:E,f:m}=y.cached(this,g,v=>ne(p,v));return ne(p,[E,m])[0]}multiplyUnsafe(d,g=p.ZERO){let E=d;return Bt("scalar",E,dt,s),E===dt?p.ZERO:this.is0()||E===j?this:y.unsafe(this,E,m=>ne(p,m),g)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return y.unsafe(this,s).is0()}toAffine(d){return l(this,d)}clearCofactor(){return o===j?this:this.multiplyUnsafe(o)}static fromBytes(d,g=!1){return Z(d),p.fromHex(d,g)}static fromHex(d,g=!1){let{d:E,a:m}=e,v=n.BYTES;d=V("pointHex",d,v),me("zip215",g);let M=d.slice(),_=d[v-1];M[v-1]=_&-129;let T=ot(M),R=g?c:n.ORDER;Bt("pointHex.y",T,dt,R);let U=i(T*T),C=i(U-j),b=i(E*U-m),{isValid:B,value:w}=f(C,b);if(!B)throw new Error("Point.fromHex: invalid y coordinate");let S=(w&j)===j,L=(_&128)!==0;if(!g&&w===dt&&L)throw new Error("Point.fromHex: x=0 and x_0=1");return L!==S&&(w=i(-w)),p.fromAffine({x:w,y:T})}toBytes(){let{x:d,y:g}=this.toAffine(),E=ht(g,n.BYTES);return E[E.length-1]|=d&j?128:0,E}toRawBytes(){return this.toBytes()}toHex(){return Nt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(e.Gx,e.Gy,j,i(e.Gx*e.Gy)),p.ZERO=new p(dt,j,j,dt),p.Fp=n,p.Fn=r;let y=new Ae(p,r.BYTES*8);return p}var ve=class{constructor(t){this.ep=t}static fromBytes(t){throw new Error("fromBytes must be implemented by subclass")}static fromHex(t){throw new Error("fromHex must be implemented by subclass")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toRawBytes(){return this.toBytes()}toHex(){return Nt(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,n){return this.init(this.ep.precompute(t,n))}};function Os(e,t,n){if(typeof t!="function")throw new Error('"hash" function param is required');qt(n,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r}=n,{BASE:o,Fp:s,Fn:c}=e,i=c.ORDER,f=n.randomBytes||X,u=n.adjustScalarBytes||(b=>b),h=n.domain||((b,B,w)=>{if(me("phflag",w),B.length||w)throw new Error("Contexts/pre-hash are not supported");return b});function l(b){return c.create(b)}function a(b){return l(ot(b))}function p(b){let B=s.BYTES;b=V("private key",b,B);let w=V("hashed private key",t(b),2*B),S=u(w.slice(0,B)),L=w.slice(B,2*B),H=a(S);return{head:S,prefix:L,scalar:H}}function y(b){let{head:B,prefix:w,scalar:S}=p(b),L=o.multiply(S),H=L.toBytes();return{head:B,prefix:w,scalar:S,point:L,pointBytes:H}}function x(b){return y(b).pointBytes}function d(b=Uint8Array.of(),...B){let w=Vt(...B);return a(t(h(w,V("context",b),!!r)))}function g(b,B,w={}){b=V("message",b),r&&(b=r(b));let{prefix:S,scalar:L,pointBytes:H}=y(B),O=d(w.context,S,b),N=o.multiply(O).toBytes(),A=d(w.context,N,H,b),k=l(O+A*L);Bt("signature.s",k,dt,i);let D=s.BYTES,q=Vt(N,ht(k,D));return V("result",q,D*2)}let E={zip215:!0};function m(b,B,w,S=E){let{context:L,zip215:H}=S,O=s.BYTES;b=V("signature",b,2*O),B=V("message",B),w=V("publicKey",w,O),H!==void 0&&me("zip215",H),r&&(B=r(B));let N=ot(b.slice(O,2*O)),A,k,D;try{A=e.fromHex(w,H),k=e.fromHex(b.slice(0,O),H),D=o.multiplyUnsafe(N)}catch{return!1}if(!H&&A.isSmallOrder())return!1;let q=d(L,k.toBytes(),A.toBytes(),B);return k.add(A.multiplyUnsafe(q)).subtract(D).clearCofactor().is0()}o.precompute(8);let v=s.BYTES,M={secret:v,public:v,signature:2*v,seed:v};function _(b=f(M.seed)){return b}let T={getExtendedPublicKey:y,randomSecretKey:_,isValidSecretKey:U,isValidPublicKey:C,randomPrivateKey:_,toMontgomery(b){let{y:B}=e.fromBytes(b),w=v===32;if(!w&&v!==57)throw new Error("only defined for 25519 and 448");let S=w?s.div(j+B,j-B):s.div(B-j,B+j);return s.toBytes(S)},toMontgomeryPriv(b){Z(b,v);let B=t(b.subarray(0,v));return u(B).subarray(0,v)},precompute(b=8,B=e.BASE){return B.precompute(b,!1)}};function R(b){let B=T.randomSecretKey(b);return{secretKey:B,publicKey:x(B)}}function U(b){try{return!!c.fromBytes(b,!1)}catch{return!1}}function C(b,B){try{return!!e.fromBytes(b,B)}catch{return!1}}return Object.freeze({keygen:R,getPublicKey:x,sign:g,verify:m,utils:T,Point:e,info:{type:"edwards",lengths:M}})}function Rs(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp,r=St(t.n,e.nBitLength,!0),o={Fp:n,Fn:r,uvRatio:e.uvRatio},s={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,hash:e.hash,eddsaOpts:s}}function Ns(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}function to(e){let{CURVE:t,curveOpts:n,hash:r,eddsaOpts:o}=Rs(e),s=Hs(t,n),c=Os(s,r,o);return Ns(e,c)}var re=BigInt(0),Xt=BigInt(1),Ie=BigInt(2);function ks(e){return qt(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}function eo(e){let t=ks(e),{P:n,type:r,adjustScalarBytes:o,powPminus2:s,randomBytes:c}=t,i=r==="x25519";if(!i&&r!=="x448")throw new Error("invalid type");let f=c||X,u=i?255:448,h=i?32:56,l=BigInt(i?9:5),a=BigInt(i?121665:39081),p=i?Ie**BigInt(254):Ie**BigInt(447),y=i?BigInt(8)*Ie**BigInt(251)-Xt:BigInt(4)*Ie**BigInt(445)-Xt,x=p+y+Xt,d=w=>F(w,n),g=E(l);function E(w){return ht(d(w),h)}function m(w){let S=V("u coordinate",w,h);return i&&(S[31]&=127),d(ot(S))}function v(w){return ot(o(V("scalar",w,h)))}function M(w,S){let L=R(m(S),v(w));if(L===re)throw new Error("invalid private or public key received");return E(L)}function _(w){return M(w,g)}function T(w,S,L){let H=d(w*(S-L));return S=d(S-H),L=d(L+H),{x_2:S,x_3:L}}function R(w,S){Bt("u",w,re,n),Bt("scalar",S,p,x);let L=S,H=w,O=Xt,N=re,A=w,k=Xt,D=re;for(let tt=BigInt(u-1);tt>=re;tt--){let it=L>>tt&Xt;D^=it,{x_2:O,x_3:A}=T(D,O,A),{x_2:N,x_3:k}=T(D,N,k),D=it;let ct=O+N,ft=d(ct*ct),at=O-N,xt=d(at*at),yt=ft-xt,_o=A+k,To=A-k,zn=d(To*ct),Pn=d(_o*at),Vn=zn+Pn,Xn=zn-Pn;A=d(Vn*Vn),k=d(H*d(Xn*Xn)),O=d(ft*xt),N=d(yt*(ft+d(a*yt)))}({x_2:O,x_3:A}=T(D,O,A)),{x_2:N,x_3:k}=T(D,N,k);let q=s(N);return d(O*q)}let U=(w=f(h))=>w,C={randomSecretKey:U,randomPrivateKey:U};function b(w){let S=C.randomSecretKey(w);return{secretKey:S,publicKey:_(S)}}let B={secret:h,public:h,seed:h};return{keygen:b,getSharedSecret:(w,S)=>M(w,S),getPublicKey:w=>_(w),scalarMult:M,scalarMultBase:_,utils:C,GuBytes:g.slice(),info:{type:"montgomery",lengths:B}}}var Ms=BigInt(0),vt=BigInt(1),no=BigInt(2),Ds=BigInt(3),qs=BigInt(5),Ks=BigInt(8),Yt={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Ks,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function so(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=Yt.p,i=e*e%s*e%s,f=nt(i,no,s)*i%s,u=nt(f,vt,s)*e%s,h=nt(u,qs,s)*u%s,l=nt(h,t,s)*h%s,a=nt(l,n,s)*l%s,p=nt(a,r,s)*a%s,y=nt(p,o,s)*p%s,x=nt(y,o,s)*p%s,d=nt(x,t,s)*h%s;return{pow_p_5_8:nt(d,no,s)*e%s,b2:i}}function io(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Un=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Cn(e,t){let n=Yt.p,r=F(t*t*t,n),o=F(r*r*t,n),s=so(e*o).pow_p_5_8,c=F(e*r*s,n),i=F(t*c*c,n),f=c,u=F(c*Un,n),h=i===e,l=i===F(-e,n),a=i===F(-e*Un,n);return h&&(c=f),(l||a)&&(c=u),At(c,n)&&(c=F(-c,n)),{isValid:h||l,value:c}}var Ft=St(Yt.p,{isLE:!0}),Fs=St(Yt.n,{isLE:!0}),js={...Yt,Fp:Ft,hash:ur,adjustScalarBytes:io,uvRatio:Cn},st=to(js);var Le=(()=>{let e=Yt.p;return eo({P:e,type:"x25519",powPminus2:t=>{let{pow_p_5_8:n,b2:r}=so(t);return F(nt(n,Ds,e)*r,e)},adjustScalarBytes:io})})();var _n=Un,Gs=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Zs=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),zs=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Ps=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),ro=e=>Cn(vt,e),Vs=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Tn=e=>st.CURVE.Fp.create(ot(e)&Vs);function oo(e){let{d:t}=st.CURVE,n=st.CURVE.Fp.ORDER,r=st.CURVE.Fp.create,o=r(_n*e*e),s=r((o+vt)*zs),c=BigInt(-1),i=r((c-t*o)*r(o+t)),{isValid:f,value:u}=Cn(s,i),h=r(u*e);At(h,n)||(h=r(-h)),f||(u=h),f||(c=o);let l=r(c*(o-vt)*Ps-i),a=u*u,p=r((u+u)*i),y=r(l*Gs),x=r(vt-a),d=r(vt+a);return new st.Point(r(p*d),r(x*y),r(y*d),r(p*x))}function Xs(e){Z(e,64);let t=Tn(e.subarray(0,32)),n=oo(t),r=Tn(e.subarray(32,64)),o=oo(r);return new It(n.add(o))}var It=class e extends ve{constructor(t){super(t)}static fromAffine(t){return new e(st.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return Xs(V("ristrettoHash",t,64))}static fromBytes(t){Z(t,32);let{a:n,d:r}=st.CURVE,o=Ft.ORDER,s=Ft.create,c=Tn(t);if(!Rr(ht(c,32),t)||At(c,o))throw new Error("invalid ristretto255 encoding 1");let i=s(c*c),f=s(vt+n*i),u=s(vt-n*i),h=s(f*f),l=s(u*u),a=s(n*r*h-l),{isValid:p,value:y}=ro(s(a*l)),x=s(y*u),d=s(y*x*a),g=s((c+c)*x);At(g,o)&&(g=s(-g));let E=s(f*d),m=s(g*E);if(!p||At(m,o)||E===Ms)throw new Error("invalid ristretto255 encoding 2");return new e(new st.Point(g,E,vt,m))}static fromHex(t){return e.fromBytes(V("ristrettoHex",t,32))}static msm(t,n){return Se(e,st.Point.Fn,t,n)}toBytes(){let{X:t,Y:n,Z:r,T:o}=this.ep,s=Ft.ORDER,c=Ft.create,i=c(c(r+n)*c(r-n)),f=c(t*n),u=c(f*f),{value:h}=ro(c(i*u)),l=c(h*i),a=c(h*f),p=c(l*a*o),y;if(At(o*p,s)){let d=c(n*_n),g=c(t*_n);t=d,n=g,y=c(l*Zs)}else y=a;At(t*p,s)&&(n=c(-n));let x=c((r-n)*y);return At(x,s)&&(x=c(-x)),ht(x,32)}equals(t){this.assertSame(t);let{X:n,Y:r}=this.ep,{X:o,Y:s}=t.ep,c=Ft.create,i=c(n*s)===c(r*o),f=c(r*s)===c(n*o);return i||f}is0(){return this.equals(e.ZERO)}};It.BASE=new It(st.Point.BASE);It.ZERO=new It(st.Point.ZERO);It.Fp=Ft;It.Fn=Fs;var co=!1,Ys=!1;async function fo(e,t){if(Ys)return await t();try{return await e()}catch(n){if(n instanceof ReferenceError||n instanceof DOMException&&n.name==="NotSupportedError")return await t();throw n}}async function Ue(e,t){return await fo(async()=>{let n=Hn(e)?e:await Ws(e),r=await crypto.subtle.importKey("raw",t,{name:"X25519"},co,[]);return new Uint8Array(await crypto.subtle.deriveBits({name:"X25519",public:r},n,256))},()=>{if(Hn(e))throw new Error("CryptoKey provided but X25519 WebCrypto is not supported");return Le.scalarMult(e,t)})}async function oe(e){return await fo(async()=>Ue(e,Le.GuBytes),()=>{if(Hn(e))throw new Error("CryptoKey provided but X25519 WebCrypto is not supported");return Le.scalarMultBase(e)})}var $s=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,110,4,34,4,32]);async function Ws(e){if(e.length!==32)throw new Error("X25519 private key must be 32 bytes");let t=new Uint8Array([...$s,...e]);return crypto.subtle.importKey("pkcs8",t,{name:"X25519"},co,["deriveBits"])}function Hn(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}var _e=class{s;transcript=[];buf=new Uint8Array(0);constructor(t){this.s=t.getReader()}async readLine(){let t=[];for(;;){let n=this.buf.indexOf(10);if(n>=0)return t.push(this.buf.subarray(0,n)),this.transcript.push(this.buf.subarray(0,n+1)),this.buf=this.buf.subarray(n+1),Js(jt(t));this.buf.length>0&&(t.push(this.buf),this.transcript.push(this.buf));let r=await this.s.read();if(r.done)return this.buf=jt(t),null;this.buf=r.value}}close(){return this.s.releaseLock(),{rest:this.buf,transcript:jt(this.transcript)}}};function Js(e){return e.forEach(t=>{if(t<32||t>126)throw Error("invalid non-ASCII byte in header")}),new TextDecoder().decode(e)}function jt(e){let t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t),r=0;for(let o of e)n.set(o,r),r+=o.length;return n}function $t(e,...t){return e.pipeThrough(new TransformStream({start(n){for(let r of t)n.enqueue(r)}}))}function Te(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}async function On(e){if(!(e instanceof ReadableStream))throw new Error("readAll expects a ReadableStream<Uint8Array>");return new Uint8Array(await new Response(e).arrayBuffer())}async function ao(e){if(!(e instanceof ReadableStream))throw new Error("readAllString expects a ReadableStream<Uint8Array>");return await new Response(e).text()}async function uo(e,t){let n=e.getReader(),r=[],o=0;for(;o<t;){let{done:f,value:u}=await n.read();if(f)throw Error("stream ended before reading "+t.toString()+" bytes");r.push(u),o+=u.length}n.releaseLock();let s=jt(r),c=s.subarray(0,t),i=$t(e,s.subarray(t));return{data:c,rest:i}}var pt=class{args;body;constructor(t,n){this.args=t,this.body=n}};async function ti(e){let t=await e.readLine();if(t===null)throw Error("invalid stanza");let n=t.split(" ");if(n.length<2||n.shift()!=="->")return{next:t};for(let s of n)if(s.length===0)throw Error("invalid stanza");let r=[];for(;;){let s=await e.readLine();if(s===null)throw Error("invalid stanza");let c=et.decode(s);if(c.length>48)throw Error("invalid stanza");if(r.push(c),c.length<48)break}let o=jt(r);return{s:new pt(n,o)}}async function lo(e){let t=new _e(e),n=await t.readLine();if(n!=="age-encryption.org/v1")throw Error("invalid version "+(n??"line"));let r=[];for(;;){let{s:o,next:s}=await ti(t);if(o!==void 0){r.push(o);continue}if(!s.startsWith("--- "))throw Error("invalid header");let c=et.decode(s.slice(4)),{rest:i,transcript:f}=t.close(),u=f.slice(0,f.length-1-s.length+3);return{stanzas:r,headerNoMAC:u,MAC:c,headerSize:f.length,rest:$t(e,i)}}}function Rn(e){let t=[];t.push(`age-encryption.org/v1
`);for(let n of e){t.push("-> "+n.args.join(" ")+`
`);for(let r=0;r<n.body.length;r+=48){let o=r+48;o>n.body.length&&(o=n.body.length),t.push(et.encode(n.body.subarray(r,o))+`
`)}n.body.length%48===0&&t.push(`
`)}return t.push("---"),new TextEncoder().encode(t.join(""))}function ho(e,t){return jt([Rn(e),new TextEncoder().encode(" "+et.encode(t)+`
`)])}function po(){let e=X(32),t=lt.encodeFromBytes("AGE-SECRET-KEY-",e).toUpperCase();return Promise.resolve(t)}async function xo(e){let t;if(yo(e))t=e;else{let r=lt.decodeToBytes(e);if(!e.startsWith("AGE-SECRET-KEY-1")||r.prefix.toUpperCase()!=="AGE-SECRET-KEY-"||r.bytes.length!==32)throw Error("invalid identity");t=r.bytes}let n=await oe(t);return lt.encodeFromBytes("age",n)}var Ce=class{recipient;constructor(t){let n=lt.decodeToBytes(t);if(!t.startsWith("age1")||n.prefix.toLowerCase()!=="age"||n.bytes.length!==32)throw Error("invalid recipient");this.recipient=n.bytes}async wrapFileKey(t){let n=X(32),r=await oe(n),o=await Ue(n,this.recipient),s=new Uint8Array(r.length+this.recipient.length);s.set(r),s.set(this.recipient,r.length);let c=Ut(Q,o,s,"age-encryption.org/v1/X25519",32);return[new pt(["X25519",et.encode(r)],Ne(t,c))]}},He=class{identity;recipient;constructor(t){if(yo(t)){this.identity=t,this.recipient=oe(t);return}let n=lt.decodeToBytes(t);if(!t.startsWith("AGE-SECRET-KEY-1")||n.prefix.toUpperCase()!=="AGE-SECRET-KEY-"||n.bytes.length!==32)throw Error("invalid identity");this.identity=n.bytes,this.recipient=oe(n.bytes)}async unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!=="X25519")continue;if(n.args.length!==2)throw Error("invalid X25519 stanza");let r=et.decode(n.args[1]);if(r.length!==32)throw Error("invalid X25519 stanza");let o=await Ue(this.identity,r),s=await this.recipient,c=new Uint8Array(r.length+s.length);c.set(r),c.set(s,r.length);let i=Ut(Q,o,c,"age-encryption.org/v1/X25519",32),f=ke(n.body,i);if(f!==null)return f}return null}},Oe=class{passphrase;logN;constructor(t,n){this.passphrase=t,this.logN=n}wrapFileKey(t){let n=X(16),r="age-encryption.org/v1/scrypt",o=new Uint8Array(r.length+16);o.set(new TextEncoder().encode(r)),o.set(n,r.length);let s=un(this.passphrase,o,{N:2**this.logN,r:8,p:1,dkLen:32});return[new pt(["scrypt",et.encode(n),this.logN.toString()],Ne(t,s))]}},Re=class{passphrase;constructor(t){this.passphrase=t}unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!=="scrypt")continue;if(t.length!==1)throw Error("scrypt recipient is not the only one in the header");if(n.args.length!==3||!/^[1-9][0-9]*$/.test(n.args[2]))throw Error("invalid scrypt stanza");let r=et.decode(n.args[1]);if(r.length!==16)throw Error("invalid scrypt stanza");let o=Number(n.args[2]);if(o>20)throw Error("scrypt work factor is too high");let s="age-encryption.org/v1/scrypt",c=new Uint8Array(s.length+16);c.set(new TextEncoder().encode(s)),c.set(r,s.length);let i=un(this.passphrase,c,{N:2**o,r:8,p:1,dkLen:32}),f=ke(n.body,i);if(f!==null)return f}return null}};function Ne(e,t){let n=new Uint8Array(12);return Ht(t,n).encrypt(e)}function ke(e,t){if(e.length!==32)throw Error("invalid stanza");let n=new Uint8Array(12);try{return Ht(t,n).decrypt(e)}catch{return null}}function yo(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}var Gt=16,kn=64*1024,Nn=kn+Gt;function go(e){let t=new Uint8Array(12),n=()=>{for(let c=t.length-2;c>=0&&(t[c]++,t[c]===0);c--);},r=!0,o=new Uint8Array(Nn),s=0;return new TransformStream({transform(c,i){for(;c.length>0;){if(s===o.length){let u=Ht(e,t).decrypt(o);i.enqueue(u),n(),s=0,r=!1}let f=Math.min(o.length-s,c.length);o.set(c.subarray(0,f),s),s+=f,c=c.subarray(f)}},flush(c){t[11]=1;let i=Ht(e,t).decrypt(o.subarray(0,s));if(!r&&i.length===0)throw new Error("final chunk is empty");c.enqueue(i)}})}function wo(e){if(e<Gt)throw Error("ciphertext is too small");if(e===Gt)return 0;let t=Math.floor(e/Nn),n=e%Nn;if(0<n&&n<=Gt)throw Error("ciphertext size is invalid");let r=e;return r-=t*Gt,r-=n>0?Gt:0,r}function bo(e){let t=new Uint8Array(12),n=()=>{for(let s=t.length-2;s>=0&&(t[s]++,t[s]===0);s--);},r=new Uint8Array(kn),o=0;return new TransformStream({transform(s,c){for(;s.length>0;){if(o===r.length){let f=Ht(e,t).encrypt(r);c.enqueue(f),n(),o=0}let i=Math.min(r.length-o,s.length);r.set(s.subarray(0,i),o),o+=i,s=s.subarray(i)}},flush(s){t[11]=1;let c=Ht(e,t).encrypt(r.subarray(0,o));s.enqueue(c)}})}function mo(e){let t=Math.max(1,Math.ceil(e/kn));return e+Gt*t}var Mn={};Fe(Mn,{decode:()=>ni,encode:()=>ei});function ei(e){let t=[];t.push(`-----BEGIN AGE ENCRYPTED FILE-----
`);for(let n=0;n<e.length;n+=48){let r=n+48;r>e.length&&(r=e.length),t.push(cn.encode(e.subarray(n,r))+`
`)}return t.push(`-----END AGE ENCRYPTED FILE-----
`),t.join("")}function ni(e){let t=e.trim().replaceAll(`\r
`,`
`).split(`
`);if(t.shift()!=="-----BEGIN AGE ENCRYPTED FILE-----")throw Error("invalid header");if(t.pop()!=="-----END AGE ENCRYPTED FILE-----")throw Error("invalid footer");function n(r,o){return r===t.length-1?o.length>0&&o.length<=64&&o.length%4===0:o.length===64}if(!t.every((r,o)=>n(o,r)))throw Error("invalid line length");if(!t.every(r=>/^[A-Za-z0-9+/=]+$/.test(r)))throw Error("invalid base64");return cn.decode(t.join(""))}var jn={};Fe(jn,{WebAuthnIdentity:()=>Fn,WebAuthnRecipient:()=>Kn,createCredential:()=>si});function Me(e){if(e.length===0)throw Error("cbor: unexpected EOF");let t=e[0]>>5,n=e[0]&31;if(n<=23)return[t,n,e.subarray(1)];if(n===24){if(e.length<2)throw Error("cbor: unexpected EOF");return[t,e[1],e.subarray(2)]}if(n===25){if(e.length<3)throw Error("cbor: unexpected EOF");return[t,e[1]<<8|e[2],e.subarray(3)]}throw Error("cbor: unsupported argument encoding")}function Eo(e){let[t,n,r]=Me(e);if(t!==0)throw Error("cbor: expected unsigned integer");return[n,r]}function Bo(e){let[t,n,r]=Me(e);if(t!==2)throw Error("cbor: expected byte string");if(n>r.length)throw Error("cbor: unexpected EOF");return[r.subarray(0,n),r.subarray(n)]}function Dn(e){let[t,n,r]=Me(e);if(t!==3)throw Error("cbor: expected text string");if(n>r.length)throw Error("cbor: unexpected EOF");return[new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0}).decode(r.subarray(0,n)),r.subarray(n)]}function Ao(e){let[t,n,r]=Me(e);if(t!==4)throw Error("cbor: expected array");let o=r,s=[];for(let c=0;c<n;c++){let i;[i,o]=Dn(o),s.push(i)}return[s,o]}function So(e){if(e<=23)return new Uint8Array([e]);if(e<=255)return new Uint8Array([24,e]);if(e<=65535)return new Uint8Array([25,e>>8,e&255]);throw Error("cbor: unsigned integer too large")}function vo(e){if(e.length<=23)return new Uint8Array([64|e.length,...e]);if(e.length<=255)return new Uint8Array([88,e.length,...e]);if(e.length<=65535)return new Uint8Array([89,e.length>>8,e.length&255,...e]);throw Error("cbor: byte string too long")}function qn(e){let t=new TextEncoder().encode(e);if(t.length<=23)return new Uint8Array([96|t.length,...t]);if(t.length<=255)return new Uint8Array([120,t.length,...t]);if(t.length<=65535)return new Uint8Array([121,t.length>>8,t.length&255,...t]);throw Error("cbor: text string too long")}function Io(e){let t=e.flatMap(n=>[...qn(n)]);if(e.length<=23)return new Uint8Array([128|e.length,...t]);if(e.length<=255)return new Uint8Array([152,e.length,...t]);if(e.length<=65535)return new Uint8Array([153,e.length>>8,e.length&255,...t]);throw Error("cbor: array too long")}var oi=[{type:"public-key",alg:-8},{type:"public-key",alg:-7},{type:"public-key",alg:-257}];async function si(e){let t=await navigator.credentials.create({publicKey:{rp:{name:"",id:e.rpId},user:{name:e.keyName,id:X(8),displayName:""},pubKeyCredParams:oi,authenticatorSelection:{requireResidentKey:e.type!=="security-key",residentKey:e.type!=="security-key"?"required":"discouraged",userVerification:"required"},hints:e.type==="security-key"?["security-key"]:[],extensions:{prf:{}},challenge:new Uint8Array([0]).buffer}});if(!t.getClientExtensionResults().prf?.enabled)throw Error("PRF extension not available (need macOS 15+, Chrome 132+)");let n=e.rpId??new URL(window.origin).hostname;return ii(t,n)}var Lo="AGE-PLUGIN-FIDO2PRF-";function ii(e,t){let n=e.response,r=So(1),o=vo(new Uint8Array(e.rawId)),s=qn(t),c=Io(n.getTransports()),i=new Uint8Array([...r,...o,...s,...c]);return lt.encode(Lo,lt.toWords(i),!1).toUpperCase()}function ci(e){let t=lt.decodeToBytes(e);if(!e.startsWith(Lo+"1"))throw Error("invalid identity");let[n,r]=Eo(t.bytes);if(n!==1)throw Error("unsupported identity version");let[o,s]=Bo(r),[c,i]=Dn(s),[f]=Ao(i);return[o,c,f]}var qe="age-encryption.org/fido2prf",De=class{credId;transports;rpId;constructor(t){if(t?.identity){let[n,r,o]=ci(t.identity);this.credId=n,this.transports=o,this.rpId=r}else this.rpId=t?.rpId}async getCredential(t){let r=(await navigator.credentials.get({publicKey:{allowCredentials:this.credId?[{id:this.credId,transports:this.transports,type:"public-key"}]:[],challenge:X(16),extensions:{prf:{eval:fi(t)}},userVerification:"required",rpId:this.rpId}})).getClientExtensionResults().prf?.results;if(r===void 0)throw Error("PRF extension not available (need macOS 15+, Chrome 132+)");return r}},Kn=class extends De{async wrapFileKey(t){let n=X(16),r=await this.getCredential(n),o=Uo(r);return[new pt([qe,et.encode(n)],Ne(t,o))]}},Fn=class extends De{async unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!==qe)continue;if(n.args.length!==2)throw Error("invalid prf stanza");let r=et.decode(n.args[1]);if(r.length!==16)throw Error("invalid prf stanza");let o=await this.getCredential(r),s=Uo(o),c=ke(n.body,s);if(c!==null)return c}return null}};function fi(e){let t=new TextEncoder().encode(qe),n=new Uint8Array(t.length+e.length+1);n.set(t,0),n[t.length]=1,n.set(e,t.length+1);let r=new Uint8Array(t.length+e.length+1);return r.set(t,0),r[t.length]=2,r.set(e,t.length+1),{first:n,second:r}}function Uo(e){if(e.second===void 0)throw Error("Missing second PRF result");let t=new Uint8Array(e.first.byteLength+e.second.byteLength);return t.set(new Uint8Array(e.first),0),t.set(new Uint8Array(e.second),e.first.byteLength),Pe(Q,t,qe)}var Gn=class{passphrase=null;scryptWorkFactor=18;recipients=[];setPassphrase(t){if(this.passphrase!==null)throw new Error("can encrypt to at most one passphrase");if(this.recipients.length!==0)throw new Error("can't encrypt to both recipients and passphrases");this.passphrase=t}setScryptWorkFactor(t){this.scryptWorkFactor=t}addRecipient(t){if(this.passphrase!==null)throw new Error("can't encrypt to both recipients and passphrases");typeof t=="string"?this.recipients.push(new Ce(t)):this.recipients.push(t)}async encrypt(t){let n=X(16),r=[],o=this.recipients;this.passphrase!==null&&(o=[new Oe(this.passphrase,this.scryptWorkFactor)]);for(let l of o)r.push(...await l.wrapFileKey(n));let s=Ut(Q,n,void 0,"header",32),c=wt(Q,s,Rn(r)),i=ho(r,c),f=X(16),u=Ut(Q,n,f,"payload",32),h=bo(u);return t instanceof ReadableStream?Object.assign($t(t.pipeThrough(h),i,f),{size:l=>mo(l)+i.length+f.length}):(typeof t=="string"&&(t=new TextEncoder().encode(t)),await On($t(Te(t).pipeThrough(h),i,f)))}},Zn=class{identities=[];addPassphrase(t){this.identities.push(new Re(t))}addIdentity(t){typeof t=="string"||ui(t)?this.identities.push(new He(t)):this.identities.push(t)}async decrypt(t,n){let r=t instanceof ReadableStream?t:Te(t),{fileKey:o,headerSize:s,rest:c}=await this.decryptHeaderInternal(r),{data:i,rest:f}=await uo(c,16),u=Ut(Q,o,i,"payload",32),h=go(u),l=f.pipeThrough(h),a=Object.assign(l,{size:p=>wo(p-s-i.length)});return t instanceof ReadableStream?a:n==="text"?await ao(l):await On(l)}async decryptHeader(t){return(await this.decryptHeaderInternal(Te(t))).fileKey}async decryptHeaderInternal(t){let n=await lo(t),r=await this.unwrapFileKey(n.stanzas);if(r===null)throw Error("no identity matched any of the file's recipients");let o=Ut(Q,r,void 0,"header",32),s=wt(Q,o,n.headerNoMAC);if(!ai(n.MAC,s))throw Error("invalid header HMAC");return{fileKey:r,headerSize:n.headerSize,rest:n.rest}}async unwrapFileKey(t){for(let n of this.identities){let r=await n.unwrapFileKey(t);if(r!==null)return r}return null}};function ai(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function ui(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}return No(li);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/abstract/montgomery.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
